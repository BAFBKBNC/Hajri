<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - ClassCount</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/lucide-element"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .header-gradient { background: linear-gradient(90deg, #4f46e5, #7c3aed); }
  </style>
</head>
<body class="bg-gray-100">

<div class="flex items-center justify-center min-h-screen px-4">
  <div class="w-full max-w-md">
    <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
      
      <div class="flex flex-col items-center justify-center p-8 header-gradient text-white">
        <lucide-icon name="graduation-cap" class="h-12 w-12 mb-2"></lucide-icon>
        <h1 class="text-3xl font-bold">ClassCount</h1>
        <p class="text-indigo-200 mt-1">Admin Portal Login</p>
      </div>

      <form id="login-form" class="p-8 space-y-6">
        
        <div>
          <label for="admin-id" class="text-sm font-medium text-gray-700">Admin ID</label>
          <div class="mt-1 relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <lucide-icon name="user-circle" class="h-5 w-5 text-gray-400"></lucide-icon>
            </div>
            <input 
              id="admin-id" 
              name="admin-id" 
              type="text" 
              autocomplete="username" 
              required 
              placeholder="Enter your Admin ID"
              class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
          </div>
        </div>

        <div>
          <label for="password" class="text-sm font-medium text-gray-700">Password</label>
          <div class="mt-1 relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <lucide-icon name="lock" class="h-5 w-5 text-gray-400"></lucide-icon>
            </div>
            <input 
              id="password" 
              name="password" 
              type="password" 
              autocomplete="current-password" 
              required 
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
          </div>
        </div>
        
        <div>
          <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">
            Sign in
          </button>
        </div>

      </form>
    </div>

    <p class="mt-6 text-center text-sm text-gray-500">
        Need to change your password? <a href="changepassword.html" class="font-medium text-indigo-600 hover:text-indigo-500">Change Password</a>
    </p>

  </div>
</div>

<script>
  // Initialize Supabase client
  const supabaseUrl = "hhttps://pwgdubtbvqnmivtupbvx.supabase.co"; // üîπ Replace with your Supabase project URL
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3Z2R1YnRidnFubWl2dHVwYnZ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwOTUzMTAsImV4cCI6MjA3MDY3MTMxMH0.kCn6JMv0kTQrkoJ7OmaxCbwZNzewRNtuOg-35nYXYXg"; // üîπ Replace with your Supabase anon key
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  // Set cookie helper
  function setCookie(name, value, hours) {
    const d = new Date();
    d.setTime(d.getTime() + (hours * 60 * 60 * 1000));
    const expires = "expires=" + d.toUTCString();
    document.cookie = `${name}=${value};${expires};path=/`;
  }

  document.getElementById('login-form').addEventListener('submit', async function(event) {
    event.preventDefault();

    const adminId = document.getElementById('admin-id').value.trim();
    const password = document.getElementById('password').value.trim();

    // Query Supabase for this admin
    const { data, error } = await supabase
      .from('admins')
      .select('id, name, course, password')
      .eq('id', adminId)
      .single();

    if (error || !data) {
      alert("‚ùå Invalid Admin ID");
      return;
    }

    if (data.password !== password) {
      alert("‚ùå Wrong password");
      return;
    }

    // Store cookies (1 hour)
    setCookie("id", data.id, 1);
    setCookie("name", data.name, 1);
    setCookie("course", data.course, 1);

    alert("‚úÖ Login successful! Redirecting...");
    window.location.href = "index.html"; // redirect to dashboard
  });
</script>

</body>
</html>
