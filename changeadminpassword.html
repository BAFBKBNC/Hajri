<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Change Password - ClassCount</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/lucide-element"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .header-gradient { background: linear-gradient(90deg, #4f46e5, #7c3aed); }
  </style>
</head>
<body class="bg-gray-100">

<div class="flex items-center justify-center min-h-screen px-4">
  <div class="w-full max-w-md">
    <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
      
      <div class="flex flex-col items-center justify-center p-8 header-gradient text-white">
        <lucide-icon name="lock" class="h-12 w-12 mb-2"></lucide-icon>
        <h1 class="text-3xl font-bold">ClassCount</h1>
        <p class="text-indigo-200 mt-1">Change Your Password</p>
      </div>

      <form id="change-password-form" class="p-8 space-y-6">
        
        <div>
          <label for="admin-id" class="text-sm font-medium text-gray-700">Admin ID</label>
          <div class="mt-1 relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <lucide-icon name="user-circle" class="h-5 w-5 text-gray-400"></lucide-icon>
            </div>
            <input 
              id="admin-id" 
              name="admin-id" 
              type="text" 
              required 
              placeholder="Enter your Admin ID"
              class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
          </div>
        </div>

        <div>
          <label for="current-password" class="text-sm font-medium text-gray-700">Current Password</label>
          <div class="mt-1 relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <lucide-icon name="key-round" class="h-5 w-5 text-gray-400"></lucide-icon>
            </div>
            <input 
              id="current-password" 
              name="current-password" 
              type="password" 
              required 
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
          </div>
        </div>

        <div>
          <label for="new-password" class="text-sm font-medium text-gray-700">New Password</label>
          <div class="mt-1 relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <lucide-icon name="shield" class="h-5 w-5 text-gray-400"></lucide-icon>
            </div>
            <input 
              id="new-password" 
              name="new-password" 
              type="password" 
              required 
              placeholder="Enter new password"
              class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
          </div>
        </div>
        
        <div>
          <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">
            Change Password
          </button>
        </div>

      </form>
    </div>

    <p class="mt-6 text-center text-sm text-gray-500">
        Back to <a href="adminlogin.html" class="font-medium text-indigo-600 hover:text-indigo-500">Login</a>
    </p>

  </div>
</div>

<script>
  // Initialize Supabase client
  const supabaseUrl = "https://pwgdubtbvqnmivtupbvx.supabase.co"; // üîπ Replace with your Supabase project URL
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3Z2R1YnRidnFubWl2dHVwYnZ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwOTUzMTAsImV4cCI6MjA3MDY3MTMxMH0.kCn6JMv0kTQrkoJ7OmaxCbwZNzewRNtuOg-35nYXYXg"; // üîπ Replace with your Supabase anon key
  const client = supabase.createClient(supabaseUrl, supabaseKey);

  document.getElementById('change-password-form').addEventListener('submit', async function(event) {
    event.preventDefault();

    const adminId = document.getElementById('admin-id').value.trim();
    const currentPassword = document.getElementById('current-password').value.trim();
    const newPassword = document.getElementById('new-password').value.trim();

    // 1. Verify current password
    const { data, error } = await client
      .from('admins')
      .select('id, password')
      .eq('id', adminId)
      .single();

    if (error || !data) {
      alert("‚ùå Invalid Admin ID");
      return;
    }

    if (data.password !== currentPassword) {
      alert("‚ùå Current password is incorrect");
      return;
    }

    // 2. Update password
    const { error: updateError } = await client
      .from('admins')
      .update({ password: newPassword })
      .eq('id', adminId);

    if (updateError) {
      alert("‚ö†Ô∏è Failed to update password");
      console.error(updateError);
      return;
    }

    alert("‚úÖ Password updated successfully! Please login again.");
    window.location.href = "adminlogin.html";
  });
</script>

</body>
</html>
